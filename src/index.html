<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Client-side Image Converter (Modern Browser APIs)</title>

    <!-- add to homescreen for ios -->
    <meta name="mobile-web-app-capable" content="yes">
    <!-- status bar style for ios -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- theme color for ios - dynamically set by script -->
    <meta name="theme-color" content="#212529" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#aa64d6" media="(prefers-color-scheme: light)">
    <!-- apple touch icon for ios -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-icon-180.png">
    <!-- favicon for browser tabs -->
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    <!-- web manifest -->
    <link rel="manifest" href="manifest.webmanifest">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script>
      // Initialize dark mode and listen for system preference changes
      (() => {
        // Listen for system theme changes
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        // Set initial theme based on system preference
       document.documentElement.setAttribute('data-bs-theme', mediaQuery.matches ? 'dark' : 'light');
        // Listen for changes
        mediaQuery.addEventListener('change', (e) => {
          document.documentElement.setAttribute('data-bs-theme', e.matches ? 'dark' : 'light');
        });
      })();
    </script>
    <style>
      .thumb-img {
        width: 56px;
        height: 56px;
        object-fit: contain;
      }
    </style>
  </head>

  <body>
    <div class="container py-4">
      <div
        class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3"
      >
        <div>
          <h1 class="display-6 fw-semibold mb-1">üñºÔ∏è Image Converter</h1>
          <p class="text-secondary mb-0">
            Select image files, choose output options, convert & download. No
            server, no libs. Modern browsers only.
          </p>
        </div>
        <span
          id="fileCount"
          class="badge text-bg-secondary align-self-start d-none"
        ></span>
      </div>

      <div class="card shadow-sm mb-3">
        <div class="card-header fw-semibold">üìÅ 1) Select images</div>
        <div class="card-body">
          <input
            id="fileInput"
            type="file"
            accept="image/*"
            multiple
            class="form-control"
          />
        </div>
      </div>

      <div class="card shadow-sm mb-3">
        <div class="card-header fw-semibold">‚öôÔ∏è 2) Output options</div>
        <div class="card-body">
          <!-- Format & Quality -->
          <div class="border rounded p-3 mb-3 bg-body-secondary">
            <h6 class="fw-semibold mb-3">üìÑ Format & Quality</h6>
            <div class="row g-3">
              <div class="col-12 col-md-6 col-lg-5">
                <label class="form-label">Format</label>
                <select id="formatSel" class="form-select"></select>
              </div>

              <div class="col-12 col-md-6 col-lg-5">
                <label class="form-label">Quality</label>
                <input
                  id="quality"
                  class="form-range"
                  type="range"
                  min="0"
                  max="1"
                  step="0.01"
                  value="0.9"
                />
                <div id="qualityVal" class="small text-secondary">0.90</div>
              </div>

              <div class="col-12 col-md-4 col-lg-2">
                <label class="form-label">JPEG background</label>
                <div class="input-group">
                  <span class="input-group-text">üé®</span>
                  <input
                    id="bg"
                    class="form-control form-control-color"
                    type="color"
                    value="#ffffff"
                    title="Choose background color"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Dimensions -->
          <div class="border rounded p-3 mb-3 bg-body-secondary">
            <h6 class="fw-semibold mb-3">üìê Dimensions</h6>
            <div class="row g-3">
              <!-- Don't resize -->
              <div class="col-12 col-md-6 col-lg-3 col-xl-2">
                <label class="form-label">Don't resize</label>
                <div class="input-group">
                  <div class="input-group-text">
                    <input
                      class="form-check-input mt-0"
                      type="radio"
                      name="sizeMode"
                      id="sizeModeNone"
                      value="none"
                      checked
                    />
                  </div>
                  <span class="form-control" style="background-color: #e9ecef;">Keep original</span>
                </div>
              </div>

              <!-- Pixel sizing -->
              <div class="col-12 col-md-8 col-lg-6 col-xl-4">
                <label class="form-label">Pixel sizing</label>
                <div class="input-group">
                  <div class="input-group-text">
                    <input
                      class="form-check-input mt-0"
                      type="radio"
                      name="sizeMode"
                      id="sizeModePixels"
                      value="pixels"
                    />
                  </div>
                  <input
                    id="outW"
                    class="form-control"
                    type="number"
                    min="1"
                    placeholder="Width"
                  />
                  <span class="input-group-text d-none d-sm-flex">√ó</span>
                  <input
                    id="outH"
                    class="form-control"
                    type="number"
                    min="1"
                    placeholder="Height"
                  />
                  <div class="input-group-text">
                    <input
                      id="lockAspect"
                      class="form-check-input mt-0"
                      type="checkbox"
                      checked
                      title="Lock aspect ratio"
                    />
                    <label class="ms-1 mb-0" for="lockAspect"> üîí </label>
                  </div>
                </div>
              </div>

              <!-- Scale sizing -->
              <div class="col-12 col-md-4 col-lg-3 col-xl-3">
                <label class="form-label">Scale sizing</label>
                <div class="input-group">
                  <div class="input-group-text">
                    <input
                      class="form-check-input mt-0"
                      type="radio"
                      name="sizeMode"
                      id="sizeModeScale"
                      value="scale"
                    />
                  </div>
                  <input
                    id="scalePct"
                    class="form-control"
                    type="number"
                    min="1"
                    max="1000"
                    value="100"
                    placeholder="Scale"
                    style="width: 100px;"
                  />
                  <span class="input-group-text">%</span>
                </div>
              </div>

              <!-- Fit mode - always on next row -->
              <div class="col-12 col-md-6 col-xl-3">
                <label class="form-label">Fit</label>
                <select id="fit" class="form-select">
                  <option value="keep">Keep (if empty)</option>
                  <option value="contain">Contain</option>
                  <option value="cover">Cover (crop)</option>
                  <option value="stretch">Stretch</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Advanced Options -->
          <div class="border rounded p-3 bg-body-secondary">
            <h6 class="fw-semibold mb-3">üîß Advanced Options</h6>
            <div class="row g-3">
              <div
                class="col-12 col-md-3 col-lg-2 d-block d-md-flex flex-direction-column align-items-md-center pt-4"
              >
                <div class="form-check">
                  <input
                    id="smoothing"
                    class="form-check-input"
                    type="checkbox"
                    checked
                  />
                  <label class="form-check-label" for="smoothing"
                    >Smoothing</label
                  >
                </div>
              </div>

              <div class="col-12 col-md-4">
                <label class="form-label">Smoothing quality</label>
                <select id="smoothingQuality" class="form-select">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high" selected>High</option>
                </select>
              </div>

              <div class="col-12 col-md-4">
                <label class="form-label">Bitmap resize</label>
                <select id="bmpResizeQuality" class="form-select">
                  <option value="off" selected>Off</option>
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="pixelated">Pixelated</option>
                </select>
              </div>
            </div>
          </div>

          <div id="caps" class="text-secondary small mt-3"></div>
        </div>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header fw-semibold">üîÑ 3) Convert</div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2 align-items-center">
            <button id="convertAll" class="btn btn-primary" disabled>
              üîÑ Convert all
            </button>
            <button id="clear" class="btn btn-outline-secondary" disabled>
              ‚ùå Clear
            </button>
            <div class="flex-grow-1">
              <progress id="prog" class="w-100" value="0" max="1"></progress>
              <div id="status" class="text-secondary small mt-1"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h4 mb-0">üìÇ Files</h2>
      </div>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Input</th>
              <th scope="col">Output</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="list"></tbody>
        </table>
      </div>
    </div>

    <script type="module" src="app/main.ts"></script>
  </body>
</html>
